<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Cube❤️</title>
    <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>❤️</text></svg>">

    <style>
        /* --- MÓDULO DE AJUSTES DE POSICIONAMIENTO MEJORADO --- */
        :root {
            /* Distancia desde el borde SUPERIOR de la pantalla hasta el título */
            --posicion-titulo-top: 3vh;
            
            /* Distancia desde el borde INFERIOR de la pantalla hasta el reproductor de música */
            --posicion-reproductor-bottom: 4vh;
        }
        /* --- FIN DEL MÓDULO DE AJUSTES --- */

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Sour Gummy', cursive;
            color: white;
            background: #000000;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        }
        
        /* --- Estilos para la pantalla de carga --- */
        #loader-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.8s ease-in-out;
        }

        #loader-wrapper.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-content {
            text-align: center;
            width: 80%;
            max-width: 400px;
        }

        .loader-bar-container {
            width: 100%;
            height: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 105, 180, 0.4);
            overflow: hidden;
            margin-bottom: 20px;
        }

        #loader-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #ff69b4, #ff1493);
            border-radius: 10px;
            transition: width 0.3s ease;
            box-shadow: 0 0 15px #ff1493;
        }

        #loader-percentage {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 0 15px rgba(255, 105, 180, 0.8);
            margin-bottom: 10px;
        }

        .loader-text {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        #bg-canvas, #cube-container {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
        }
        #bg-canvas { z-index: -2; }
        #cube-container { z-index: -1; }

        .content {
            position: fixed;
            top: 0; left: 0;
            z-index: 1;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0; /* Oculto inicialmente */
            transition: opacity 0.8s ease-in-out 0.5s; /* Transición para aparecer */
        }

        .content.visible {
            opacity: 1; 
        }
        
        .content > * {
            pointer-events: auto;
        }

        h1 {
            position: absolute;
            top: var(--posicion-titulo-top);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            text-align: center;
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 700;
            text-shadow: 0 0 15px rgba(255, 105, 180, 0.8), 0 0 20px rgba(255, 105, 180, 0.6);
            margin: 0;
        }
        
        .music-player-container {
            position: absolute;
            bottom: var(--posicion-reproductor-bottom);
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .message-icon {
            align-self: flex-start;
            width: 40px; height: 40px;
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.4), rgba(255, 20, 147, 0.3));
            border-radius: 50%; display: flex;
            align-items: center; justify-content: center;
            cursor: pointer; border: 2px solid rgba(255, 105, 180, 0.6);
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.8);
            transition: all 0.3s ease;
            animation: heartbeat 2s infinite;
        }

        .message-icon:hover {
            box-shadow: 0 0 25px rgba(255, 105, 180, 1);
            transform: scale(1.1);
        }

        .message-icon svg { width: 20px; height: 20px; fill: white; }

        @keyframes heartbeat {
            0% { transform: scale(1); } 14% { transform: scale(1.1); } 28% { transform: scale(1); }
            42% { transform: scale(1.1); } 70% { transform: scale(1); }
        }

        .music-player {
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.2), rgba(255, 20, 147, 0.15));
            border-radius: 20px; padding: 15px;
            width: 100%; box-shadow: 0 8px 32px rgba(255, 105, 180, 0.3);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 105, 180, 0.4);
            display: flex; align-items: center; gap: 15px;
        }

        #play-pause-btn {
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.3), rgba(255, 20, 147, 0.2));
            border: 2px solid rgba(255, 105, 180, 0.8); border-radius: 50%;
            width: 50px; height: 50px;
            cursor: pointer; color: white;
            transition: all 0.3s ease; display: flex;
            align-items: center; justify-content: center;
            flex-shrink: 0;
        }

        #play-pause-btn:hover { transform: scale(1.05); }
        
        .progress-container { 
            flex-grow: 1; display: flex; align-items: center; gap: 15px; 
            position: relative;
        }
        
        #progress-bar { 
            width: 100%; 
            -webkit-appearance: none; 
            appearance: none; 
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px; 
            outline: none; 
            cursor: pointer;
        }
        
        #progress-bar::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            appearance: none; 
            width: 18px; 
            height: 18px; 
            background: linear-gradient(135deg, #ff69b4, #ff1493); 
            border-radius: 50%; 
            cursor: pointer; 
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.8);
            position: relative;
            z-index: 10;
        }
        
        #progress-bar::-moz-range-thumb {
            width: 18px; height: 18px; background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 50%; cursor: pointer; border: 2px solid white;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.8); position: relative; z-index: 10;
        }
        
        .time-display {
            font-size: 0.9rem;
            min-width: 85px;
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
        }

        .icon-svg { width: 22px; height: 22px; fill: currentColor; }

        .love-message-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .love-message-content { background: linear-gradient(135deg, rgba(255, 105, 180, 0.15), rgba(255, 20, 147, 0.1)); border: 2px solid rgba(255, 105, 180, 0.4); border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; text-align: center; position: relative; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); box-shadow: 0 15px 35px rgba(255, 105, 180, 0.3); }
        .close-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .love-message-text { font-family: 'Sour Gummy', cursive; font-size: 1.2rem; line-height: 1.6; margin-bottom: 20px; }
        .love-gif { width: 150px; height: 150px; border-radius: 10px; object-fit: cover; }

        @media (max-width: 480px) {
            .music-player { padding: 10px; gap: 10px; }
            #play-pause-btn { width: 45px; height: 45px; }
            .icon-svg { width: 20px; height: 20px; }
            #progress-bar::-webkit-slider-thumb { width: 16px; height: 16px; }
            #progress-bar::-moz-range-thumb { width: 16px; height: 16px; }
            .time-display { min-width: 80px; font-size: 0.85rem;}
        }
    </style>
</head>
<body>

    <div id="loader-wrapper">
        <div class="loader-content">
            <div class="loader-bar-container">
                <div id="loader-bar"></div>
            </div>
            <div id="loader-percentage">0%</div>
            <div class="loader-text">Cargando nuestro universo...</div>
        </div>
    </div>

    <canvas id="bg-canvas"></canvas>
    <div id="cube-container"></div>

    <div class="content">
        <h1>I ❤️ YOU</h1>
        
        <div class="music-player-container">
            <div class="message-icon" id="message-btn">
                <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17l-.59.59-.58.58V4h16v12z"/><circle cx="12" cy="10" r="1"/><circle cx="8" cy="10" r="1"/><circle cx="16" cy="10" r="1"/></svg>
            </div>
            <div class="music-player">
                <audio id="audio-player" src="https://www.dl.dropboxusercontent.com/scl/fi/t8ezkh6vn2cy6jphq1dol/HERE-WITH-ME.mp3?rlkey=vm6b8t28z8jpdxoejkta1ou0y&st=uua3d1mz" autoplay loop></audio>
                <button id="play-pause-btn">
                    <svg class="icon-svg play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg class="icon-svg pause-icon" viewBox="0 0 24 24" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>
                <div class="progress-container">
                    <input type="range" id="progress-bar" value="0" step="1">
                    <div class="time-display">
                        <span id="current-time">0:00</span> / <span id="total-duration">0:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="love-message-modal" id="loveMessageModal">
        <div class="love-message-content" id="loveMessageContent">
            <button class="close-btn" id="closeMessageBtn">×</button>
            <div class="love-message-text">Mi amor, cada día que pasa mi corazón se llena más de ti. Eres la luz que ilumina mis días más oscuros y la razón por la que sonrío. Te amo más de lo que las palabras pueden expresar. 💕</div>
            <img src="https://i.pinimg.com/originals/70/f4/f3/70f4f3495eecb3dc3a8694ee9e2505a9.gif" alt="Love GIF" class="love-gif">
        </div>
    </div>

    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.157.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- Selectores para la pantalla de carga y contenido principal ---
        const loaderWrapper = document.getElementById('loader-wrapper');
        const loaderBar = document.getElementById('loader-bar');
        const loaderPercentage = document.getElementById('loader-percentage');
        const mainContent = document.querySelector('.content');

        const SETTINGS = {
            cubeSize: 3.5, rotationSpeedX: 0.003, rotationSpeedY: 0.005,
            faceBrightness: { right: 0.05, left: 0.05, top: 0.05, bottom: 0.05, front: 0.05, back: 0.05 },
            globalFillLightIntensity: 0.2, edgeThickness: 0.02, edgeEmissiveIntensity: 10,
            bloomStrength: 0.7, bloomRadius: 0.1, bloomThreshold: 0.05, sceneParticleCount: 2000
        };

        let scene, camera, renderer, cubeGroup, controls, composer;
        let starField, particleData = [];

        function initCube() {
            // --- Gestor de Carga de Three.js ---
            const loadingManager = new THREE.LoadingManager();
            loadingManager.onProgress = (url, itemsLoaded, itemsTotal) => {
                const progress = (itemsLoaded / itemsTotal) * 100;
                loaderBar.style.width = progress + '%';
                loaderPercentage.textContent = Math.round(progress) + '%';
            };

            loadingManager.onLoad = () => {
                setTimeout(() => {
                    loaderWrapper.classList.add('hidden');
                    mainContent.classList.add('visible');
                }, 500); 
            };

            const container = document.getElementById('cube-container');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 7; 
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ReinhardToneMapping;
            renderer.toneMappingExposure = 1.2;
            container.appendChild(renderer.domElement);
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass( new THREE.Vector2(window.innerWidth, window.innerHeight), SETTINGS.bloomStrength, SETTINGS.bloomRadius, SETTINGS.bloomThreshold );
            composer = new EffectComposer(renderer);
            composer.addPass(renderScene); composer.addPass(bloomPass);
            cubeGroup = new THREE.Group();
            scene.add(cubeGroup);
            const geometry = new THREE.BoxGeometry(SETTINGS.cubeSize, SETTINGS.cubeSize, SETTINGS.cubeSize);
            
            // --- Se pasa el loadingManager al TextureLoader ---
            const textureLoader = new THREE.TextureLoader(loadingManager);
            const textureUrls = ['https://media.tenor.com/eZ3-D6GWnfEAAAAM/bubu-and-dudu.gif', 'https://media.istockphoto.com/id/629721354/es/foto/feliz-sostiene-rojo-coraz%C3%B3n-amante-de-los-dedos.jpg?s=612x612&w=0&k=20&c=fJCJQBvCrh2PWxK_j_zm7xlsuQnJJMHcl9gvlww88zE=', 'https://media.desenio.com/site_images/685d718a67fd6077b6f2e032_2000914833_18197-5.jpg?auto=compress%2Cformat&fit=max&w=3840', 'https://images.squarespace-cdn.com/content/v1/5919dd059f74568eef687d96/1568646271089-MHH5ATXHGP26CZ71S4VG/image-asset.jpeg', 'https://www.shutterstock.com/image-vector/seamless-pattern-chaotic-hearts-vector-600nw-2256662439.jpg', 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR2GfuEA0Hp14YkKc_FR0Fq49UmPimLk09bqw&s'];
            const faceOrder = ['right', 'left', 'top', 'bottom', 'front', 'back'];
            const materials = faceOrder.map((faceName, index) => {
                const texture = textureLoader.load(textureUrls[index], (tex) => {
                    tex.wrapS = THREE.ClampToEdgeWrapping; tex.wrapT = THREE.ClampToEdgeWrapping;
                    const img = tex.image;
                    if (img && img.width && img.height) {
                        const aspect = img.width / img.height;
                        if (aspect > 1) { tex.repeat.set(1 / aspect, 1); tex.offset.set((1 - 1 / aspect) / 2, 0); } 
                        else { tex.repeat.set(1, aspect); tex.offset.set(0, (1 - aspect) / 2); }
                    }
                    tex.magFilter = THREE.LinearFilter; tex.minFilter = THREE.LinearMipmapLinearFilter; tex.needsUpdate = true;
                });
                return new THREE.MeshStandardMaterial({ map: texture, emissive: 0xffffff, emissiveMap: texture, emissiveIntensity: SETTINGS.faceBrightness[faceName], roughness: 0.3, metalness: 0.1 });
            });
            const cube = new THREE.Mesh(geometry, materials);
            cubeGroup.add(cube);
            createGlowingEdges(SETTINGS.cubeSize);
            const fillLight = new THREE.AmbientLight(0xffffff, SETTINGS.globalFillLightIntensity);
            scene.add(fillLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.3);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            createSceneParticles();
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; controls.dampingFactor = 0.05;
            controls.enablePan = false; controls.enableZoom = false;
            window.addEventListener('resize', onWindowResize, false);
        }

        function createGlowingEdges(size) {
            const edgeThickness = SETTINGS.edgeThickness;
            const edgeGeometry = new THREE.BoxGeometry(size, edgeThickness, edgeThickness);
            const edgeMaterial = new THREE.MeshStandardMaterial({ color: 0xff69b4, emissive: 0xff69b4, emissiveIntensity: SETTINGS.edgeEmissiveIntensity, transparent: true, opacity: 0.9 });
            const s = size / 2;
            const createEdge = (p, r) => { const e = new THREE.Mesh(edgeGeometry, edgeMaterial); e.position.set(p.x, p.y, p.z); e.rotation.set(r.x, r.y, r.z); cubeGroup.add(e); };
            createEdge({ x: 0, y: s, z: s }, { x: 0, y: 0, z: 0 }); createEdge({ x: 0, y: s, z: -s }, { x: 0, y: 0, z: 0 }); createEdge({ x: 0, y: -s, z: s }, { x: 0, y: 0, z: 0 }); createEdge({ x: 0, y: -s, z: -s }, { x: 0, y: 0, z: 0 });
            createEdge({ x: s, y: 0, z: s }, { x: 0, y: 0, z: Math.PI / 2 }); createEdge({ x: s, y: 0, z: -s }, { x: 0, y: 0, z: Math.PI / 2 }); createEdge({ x: -s, y: 0, z: s }, { x: 0, y: 0, z: Math.PI / 2 }); createEdge({ x: -s, y: 0, z: -s }, { x: 0, y: 0, z: Math.PI / 2 });
            createEdge({ x: s, y: s, z: 0 }, { x: 0, y: Math.PI / 2, z: 0 }); createEdge({ x: s, y: -s, z: 0 }, { x: 0, y: Math.PI / 2, z: 0 }); createEdge({ x: -s, y: s, z: 0 }, { x: 0, y: Math.PI / 2, z: 0 }); createEdge({ x: -s, y: -s, z: 0 }, { x: 0, y: Math.PI / 2, z: 0 });
        }

        function createSceneParticles() {
            const particleCount = SETTINGS.sceneParticleCount;
            const positions = new Float32Array(particleCount * 3); const colors = new Float32Array(particleCount * 3);
            const particleBoxSize = 20;
            for (let i = 0; i < particleCount; i++) {
                positions.set([(Math.random() - 0.5) * particleBoxSize, (Math.random() - 0.5) * particleBoxSize, (Math.random() - 0.5) * particleBoxSize], i * 3);
                colors.set([0.2, 0.3, 0.8], i * 3);
                particleData.push({ brightness: 0.1, isFadingIn: Math.random() > 0.5, fadeSpeed: Math.random() * 0.005 + 0.002 });
            }
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3)); geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            const material = new THREE.PointsMaterial({ size: 0.05, vertexColors: true, transparent: true, opacity: 0.8 });
            starField = new THREE.Points(geometry, material); scene.add(starField);
        }

        function animateSceneParticles() {
            const colorAttribute = starField.geometry.attributes.color;
            for (let i = 0; i < SETTINGS.sceneParticleCount; i++) {
                const data = particleData[i];
                if (data.isFadingIn) { data.brightness += data.fadeSpeed; if (data.brightness >= 1.0) { data.brightness = 1.0; data.isFadingIn = false; } } 
                else { data.brightness -= data.fadeSpeed; if (data.brightness <= 0.1) { data.brightness = 0.1; data.isFadingIn = true; } }
                colorAttribute.setXYZ(i, data.brightness * 0.3, data.brightness * 0.5, data.brightness);
            }
            colorAttribute.needsUpdate = true;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight); composer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            if (cubeGroup && !controls.state) { cubeGroup.rotation.x += SETTINGS.rotationSpeedX; cubeGroup.rotation.y += SETTINGS.rotationSpeedY; }
            animateSceneParticles(); controls.update(); composer.render();
        }

        const bgCanvas = document.getElementById('bg-canvas'); const bgCtx = bgCanvas.getContext('2d');
        let particles = []; const numParticles = 800;
        function resizeBgCanvas() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
        function createParticles() { particles = []; for (let i = 0; i < numParticles; i++) { particles.push({ x: Math.random() * bgCanvas.width, y: Math.random() * bgCanvas.height, radius: Math.random() * 1.5 + 0.5, baseAlpha: 0.3 + Math.random() * 0.6, alpha: 0, alphaChange: Math.random() * 0.03 - 0.015, r: Math.random() * 100 + 100, g: Math.random() * 150 + 150, b: 255 }); } }
        function animateParticles() { 
            const gradient = bgCtx.createLinearGradient(0, 0, 0, bgCanvas.height);
            gradient.addColorStop(0, 'rgba(26, 35, 126, 0.8)'); gradient.addColorStop(0.3, 'rgba(57, 73, 171, 0.6)'); gradient.addColorStop(0.7, 'rgba(92, 107, 192, 0.4)'); gradient.addColorStop(1, 'rgba(121, 134, 203, 0.3)');
            bgCtx.fillStyle = gradient; bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
            particles.forEach(p => { p.alpha += p.alphaChange; if (p.alpha <= 0 || p.alpha >= p.baseAlpha) p.alphaChange *= -1; bgCtx.beginPath(); bgCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2); bgCtx.fillStyle = `rgba(${p.r}, ${p.g}, ${p.b}, ${p.alpha})`; bgCtx.fill(); }); 
            requestAnimationFrame(animateParticles); 
        }
        window.addEventListener('resize', () => { resizeBgCanvas(); createParticles(); });
        
        // --- LÓGICA MEJORADA DEL REPRODUCTOR DE MÚSICA ---
        const audioPlayer = document.getElementById('audio-player'); 
        const playPauseBtn = document.getElementById('play-pause-btn'); 
        const playIcon = document.querySelector('.play-icon'); 
        const pauseIcon = document.querySelector('.pause-icon'); 
        const progressBar = document.getElementById('progress-bar'); 
        const currentTimeDisplay = document.getElementById('current-time');
        const totalDurationDisplay = document.getElementById('total-duration');
        
        audioPlayer.play().catch(error => { document.body.addEventListener('click', () => audioPlayer.play(), { once: true }); });
        function togglePlayPause() { if (audioPlayer.paused) { audioPlayer.play(); } else { audioPlayer.pause(); } }
        
        function updateProgress() { 
            const { duration, currentTime } = audioPlayer; 
            const progressPercent = (currentTime / duration) * 100; 
            progressBar.value = isNaN(progressPercent) ? 0 : progressPercent;
            progressBar.style.background = `linear-gradient(to right, rgba(255, 105, 180, 0.8) ${progressPercent}%, rgba(255, 255, 255, 0.2) ${progressPercent}%)`;
            
            // Actualizar el tiempo actual en la UI
            if(isFinite(currentTime)) {
                currentTimeDisplay.textContent = formatTime(currentTime);
            }
        }
        function formatTime(seconds) { 
            const minutes = Math.floor(seconds / 60); 
            const secs = Math.floor(seconds % 60); 
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`; 
        }
        
        playPauseBtn.addEventListener('click', togglePlayPause); 
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('play', () => { playIcon.style.display = 'none'; pauseIcon.style.display = 'block'; }); 
        audioPlayer.addEventListener('pause', () => { playIcon.style.display = 'block'; pauseIcon.style.display = 'none'; });
        progressBar.addEventListener('input', () => { if (isFinite(audioPlayer.duration)) audioPlayer.currentTime = (progressBar.value / 100) * audioPlayer.duration; });
        audioPlayer.addEventListener('loadedmetadata', () => { 
            if (isFinite(audioPlayer.duration)) { 
                progressBar.max = 100; 
                totalDurationDisplay.textContent = formatTime(audioPlayer.duration);
                updateProgress(); 
            } 
        });
        
        const messageBtn = document.getElementById('message-btn'); const loveMessageModal = document.getElementById('loveMessageModal'); const closeMessageBtn = document.getElementById('closeMessageBtn');
        messageBtn.addEventListener('click', () => { loveMessageModal.style.display = 'flex'; });
        closeMessageBtn.addEventListener('click', () => { loveMessageModal.style.display = 'none'; });
        loveMessageModal.addEventListener('click', (e) => { if (e.target === loveMessageModal) loveMessageModal.style.display = 'none'; });
        document.getElementById('loveMessageContent').addEventListener('click', (e) => e.stopPropagation());

        initCube();
        animate();
        resizeBgCanvas();
        createParticles();
        animateParticles();
    </script>
</body>
</html>